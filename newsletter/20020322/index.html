<HTML>
<HEAD><TITLE>Enabling IPv6 in MacOS X (10.1.3)</TITLE></HEAD>
<BODY>
<H1>Enabling IPv6 in MacOS X (10.1.3)</H1>
<A HREF=http://www.itojun.org/>Jun-ichiro itojun Itoh</A>,
<A HREF=http://www.kame.net/>KAME Project</A>
<PRE>$Id: index.html,v 1.3 2002/03/23 08:58:53 itojun Exp $</PRE>

<HR>
<H2>Introduction</H2>

The document describes how you can enable Ipv6 in MacOS X (10.1.3),
using Darwin public source code.

<HR>
<H2>Building kernel</H2>
<UL>
<LI><A HREF=http://www.opensource.apple.com/apsl/>Sign up to Apple developer program.</A>

<LI>Install <A HREF=http://www.opensource.apple.com/projects/darwin/index.html>Darwin developer environment</A>.

<LI>Checkout kernel source code, by the following command.  Some recommends
<TT>Apple-201-19</TT> instead, not sure which one is more correct.
<PRE>
% cvs -d :pserver:yourid@anoncvs.opensource.apple.com:/cvs/Darwin checkout -r Apple-201-15 xnu
</PRE>

<LI>Apply <A HREF=ftp://ftp.itojun.org/pub/misc/darwin-v6-patch.Apple-201-15.diff>the patch</A>.

<LI>Build the kernel by the following commands.
<PRE>
% cd xnu
% source SETUP/setup.csh
% make exporthdrs
% make
</PRE>

<LI>Replace <TT>/mach_kernel</TT> by <TT>xnu/BUILD/obj/RELEASE_PPC/mach_kernel</TT>, pray, and reboot.
</UL>

<HR>
<H2>Building library</H2>
Apple <TT>/usr/lib/libc.dylib</TT> lacks many of critical library functions,
and some of them behave very strange.
Install <TT>libbind.a</TT> from BIND8.
The easiest way is to <A HREF=http://www.netbsd.org/zoularis/#darwin>use NetBSD pkgsrc</A>.

Get the latest NetBSD pkgsrc by <A HREF=http://www.netbsd.org/mirrors/#anoncvs>anoncvs</A>:
<PRE>
% cvs -z3 -d :pserver:anoncvs@anoncvs.netbsd.org:/cvsroot login
% cvs -z3 -d :pserver:anoncvs@anoncvs.netbsd.org:/cvsroot co -P pkgsrc
</PRE>

Then, get darwin-bootstrap.tar.gz and build it.
<PRE>
% tar zxvf darwin-bootstrap.tar.gz
% cd bootstrap-pkgsrc
% sudo ./bootstrap --pkgsrcdir=pkgsrc
</PRE>

Go to <TT>pkgsrc/net/bind8</TT> and build it.
<PRE>
% cd pkgsrc/net/bind8
% bmake
% sudo bmake install
</PRE>

<HR>
<H2>Building userland tools</H2>
IPv6-ready OpenSSH:
Unshar <A HREF=openssh-302p1-pkgsrc.shar>this file</A> under <TT>pkgsrc/security</TT>
and build it.
<PRE>
% cd pkgsrc/security/openssh
% bmake PKG_SYSCONFDIR=/etc
% sudo bmake PKG_SYSCONFDIR=/etc install
</PRE>

If you would like to start IPv6-ready sshd at startup, modify
<TT>/System/Library/StartupItems/SSH/SSH</TT>.

<!--#include virtual="../index.inc" -->
</BODY>
</HTML>
